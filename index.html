<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Guide</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Prism.js for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>

    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-primary: #000000;   /* Black - Dominant, Headers, Active Nav */
            --color-secondary: #ffd900; /* Yellow - High contrast accents */
            --color-accent: #67c50a;    /* Lime Green - Success/Positive */
            --color-soft: #054e6f;      /* Deep Blue - Subtler text/border elements (was primary) */
            --color-light: #f8fafc;     /* Background */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-light); 
            color: var(--color-primary);
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Roboto Slab', serif;
        }
        
        /* Custom Scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #F3F4F6; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary); 
        }

        /* Prism Overrides for cleaner inline code */
        code[class*="language-"], pre[class*="language-"] {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 0.9em;
            background: #111 !important; /* Very dark background for code blocks */
            color: #eee !important;
            border-radius: 6px;
            border: 1px solid #333;
        }

        /* Prism Token Colors adjustment for High Contrast */
        /* Since we can't easily change prism CSS file, we rely on the theme but override inline code */

        :not(pre) > code[class*="language-"] {
            padding: 0.2em 0.4em;
            border-radius: 0.3em;
            white-space: normal;
            background-color: #e2e8f0 !important; /* Slightly darker light bg for contrast */
            color: #1e293b !important; /* Dark text base */
            font-weight: 600;
            border: 1px solid #cbd5e1;
        }

        /* Token color overrides for inline code (light background) */
        :not(pre) > code[class*="language-"] .token.comment,
        :not(pre) > code[class*="language-"] .token.prolog,
        :not(pre) > code[class*="language-"] .token.doctype,
        :not(pre) > code[class*="language-"] .token.cdata {
            color: #64748b; /* Slate 500 */
        }

        :not(pre) > code[class*="language-"] .token.punctuation {
            color: #334155; /* Slate 700 */
        }

        :not(pre) > code[class*="language-"] .token.property,
        :not(pre) > code[class*="language-"] .token.tag,
        :not(pre) > code[class*="language-"] .token.boolean,
        :not(pre) > code[class*="language-"] .token.number,
        :not(pre) > code[class*="language-"] .token.constant,
        :not(pre) > code[class*="language-"] .token.symbol,
        :not(pre) > code[class*="language-"] .token.deleted {
            color: #0d9488; /* Teal 600 - Readable Green/Teal */
        }

        :not(pre) > code[class*="language-"] .token.selector,
        :not(pre) > code[class*="language-"] .token.attr-name,
        :not(pre) > code[class*="language-"] .token.string,
        :not(pre) > code[class*="language-"] .token.char,
        :not(pre) > code[class*="language-"] .token.builtin,
        :not(pre) > code[class*="language-"] .token.inserted {
            color: #054e6f; /* Using our Deep Blue for Strings/Attrs */
        }

        :not(pre) > code[class*="language-"] .token.operator,
        :not(pre) > code[class*="language-"] .token.entity,
        :not(pre) > code[class*="language-"] .token.url,
        :not(pre) > code[class*="language-"] .language-css .token.string,
        :not(pre) > code[class*="language-"] .style .token.string {
            color: #a855f7; /* Purple 500 */
        }

        :not(pre) > code[class*="language-"] .token.atrule,
        :not(pre) > code[class*="language-"] .token.attr-value,
        :not(pre) > code[class*="language-"] .token.keyword {
            color: #d97706; /* Amber 600 - Readable Orange/Brown for Keywords (WHERE, AND) */
        }
        
        :not(pre) > code[class*="language-"] .token.function,
        :not(pre) > code[class*="language-"] .token.class-name {
            color: #dc2626; /* Red 600 */
        }
        
        :not(pre) > code[class*="language-"] .token.regex,
        :not(pre) > code[class*="language-"] .token.important,
        :not(pre) > code[class*="language-"] .token.variable {
            color: #ea580c; /* Orange 600 */
        }
        
        .nav-item {
            color: #64748b;
        }
        .nav-item:hover {
            color: var(--color-primary);
            background-color: #f1f5f9;
        }
        .nav-item.active {
            background-color: var(--color-secondary);
            border-left: 4px solid var(--color-primary);
            color: var(--color-primary);
            font-weight: 800;
        }

        a.nav-item {
            text-decoration: none;
            display: block;
        }

        /* Mobile menu links (dark background) */
        #mobile-menu a {
            color: white;
            text-decoration: none;
        }
        #mobile-menu a:hover {
            background-color: transparent;
            color: var(--color-secondary);
        }

        a {
            color: var(--color-primary);
            text-decoration: underline;
            text-decoration-color: var(--color-secondary);
            text-decoration-thickness: 2px;
            text-underline-offset: 2px;
        }
        a:hover {
            background-color: var(--color-secondary);
            color: var(--color-primary);
            text-decoration: none;
        }

        /* Control Buttons (Brutalist style) */
        .control-btn {
            position: relative;
            padding: 0.5rem 1rem;
            border: 2px solid var(--color-primary);
            color: var(--color-primary);
            background-color: white;
            font-size: 0.875rem;
            border-radius: 0.25rem;
            font-weight: 700;
            box-shadow: 3px 3px 0 0 var(--color-primary);
            transition: all 200ms ease;
            cursor: pointer;
        }
        .control-btn:hover {
            background-color: var(--color-secondary);
        }
        .control-btn:active {
            box-shadow: none;
            transform: translate(3px, 3px);
        }
        .control-btn.is-active {
            background-color: var(--color-primary);
            color: white;
            box-shadow: none;
            transform: translate(3px, 3px);
        }

        /* Table Styling */
        .data-table th {
            background-color: #F3F4F6;
            color: #4B5563;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        .data-table td {
            border-bottom: 1px solid #E5E7EB;
        }
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        /* Smooth transitions */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }
    </style>



</head>
<body class="h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside aria-label="Kapitelnavigation" class="w-64 bg-white border-r border-gray-200 flex flex-col hidden md:flex z-10 shadow-sm relative">
        <div class="p-6 border-b border-gray-100">
            <h1 class="text-xl font-bold text-gray-800" style="font-family: 'Roboto Slab', serif;">SQL</h1>
            <p class="text-xs text-gray-500 mt-1">Interaktiver Guide</p>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li><a href="#intro"  id="nav-intro"  class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">1. SELECT &amp; FROM</a></li>
                <li><a href="#where" id="nav-where" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">2. WHERE Filter</a></li>
                <li><a href="#orderby" id="nav-orderby" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">3. ORDER BY (Einfach)</a></li>
                <li><a href="#orderby-multi" id="nav-orderby-multi" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">4. ORDER BY (Komplex)</a></li>
                <li><a href="#and" id="nav-and" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">5. AND</a></li>
                <li><a href="#limit" id="nav-limit" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">6. LIMIT</a></li>
                <li><a href="#distinct" id="nav-distinct" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">7. DISTINCT</a></li>
                <li><a href="#datetime" id="nav-datetime" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">8. DATETIME</a></li>
                <li><a href="#strings" id="nav-strings" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">9. Zeichenketten</a></li>
                <li><a href="#summary" id="nav-summary" class="nav-item w-full text-left px-6 py-3 text-sm text-gray-600 hover:bg-gray-50 transition-colors">Zusammenfassung &amp; Quiz</a></li>
            </ul>
        </nav>
        <div class="p-4 border-t border-gray-100">
            <div class="text-xs text-gray-400">Basierend auf SQL Guide Report</div>
        </div>
    </aside>

    <!-- Mobile Header -->
    <div class="md:hidden fixed w-full bg-white border-b z-20 flex justify-between items-center p-4">
        <h1 class="font-bold text-gray-800">SQL Guide</h1>
        <button id="mobile-menu-btn" aria-expanded="false" aria-controls="mobile-menu" aria-label="Navigationsmen√º √∂ffnen" class="text-gray-600 focus:outline-none">
            ‚ò∞ Men√º
        </button>
    </div>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full relative overflow-hidden pt-14 md:pt-0 pb-16 md:pb-0"> 
        
        <!-- Mobile Tab Bar (Bottom Navigation) -->
        <div class="md:hidden fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 z-30 flex justify-around items-center h-16 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
            <button onclick="switchMobileTab('content')" id="tab-content" aria-pressed="true" aria-label="Lerninhalt anzeigen" class="flex-1 flex flex-col items-center justify-center h-full text-[var(--color-primary)] bg-gray-50 border-t-4 border-[var(--color-secondary)]">
                <span class="text-2xl" aria-hidden="true">üìñ</span>
                <span class="text-xs font-bold mt-1">Lernen</span>
            </button>
            <button onclick="switchMobileTab('simulation')" id="tab-simulation" aria-pressed="false" aria-label="Simulation anzeigen" class="flex-1 flex flex-col items-center justify-center h-full text-gray-400 hover:text-[var(--color-primary)]">
                <span class="text-2xl" aria-hidden="true">üß™</span>
                <span class="text-xs font-bold mt-1">Labor</span>
            </button>
        </div>

        <!-- Interactive Workspace -->
        <div class="flex flex-col lg:flex-row h-full overflow-y-auto lg:overflow-hidden">
            
            <!-- LEFT: Educational Context (Scrollable) -->
            <div id="content-area" class="w-full lg:w-5/12 h-auto lg:h-full overflow-y-visible lg:overflow-y-auto p-6 lg:p-10 bg-[#f8fafc] md:block custom-scrollbar pb-24 lg:pb-10">
                <!-- Dynamic Content Injected Here -->
            </div>

            <!-- RIGHT: Live Simulation (Fixed/Scrollable depending on height) -->
            <div id="simulation-area" class="w-full lg:w-7/12 bg-white border-l border-[#e2e8f0] flex-col h-full md:h-[600px] lg:h-full hidden md:flex shrink-0">
                
                <!-- Simulation Header -->
                <div class="p-4 border-b border-[#e2e8f0] bg-[#f8fafc] flex justify-between items-center">
                    <span style="color: var(--color-primary)" class="font-bold text-sm">Live Datenbank Vorschau: <code class="bg-gray-100 px-2 py-1 rounded text-xs text-gray-800 border border-gray-200">tabelle: filme</code></span>
                    <button onclick="resetData()" class="text-xs font-semibold px-2 py-1 rounded text-[#054e6f] hover:bg-[#e0f2fe]">Reset Simulation</button>
                </div>

                <!-- Controls & visualization -->
                <div class="flex-1 overflow-y-auto p-6 space-y-6">
                    
                    <!-- Query Builder Display -->
                    <div style="background-color: var(--color-primary); border-left: 6px solid var(--color-secondary);" class="rounded-lg p-4 font-mono text-sm text-white shadow-md">
                        <div class="text-xs text-[#7cd7c2] mb-2 uppercase tracking-wide font-bold">Aktueller Query</div>
                        <div id="query-display" aria-live="polite" aria-label="Aktueller SQL-Query" class="font-bold text-lg leading-relaxed">SELECT * FROM filme;</div>
                    </div>

                    <!-- Interactive Controls Area -->
                    <div id="controls-area" class="bg-white p-6 rounded-lg border border-[var(--color-soft)] shadow-md">
                        <h3 id="controls-label" class="text-xs font-bold text-[var(--color-primary)] uppercase mb-4 tracking-widest">W√§hle eine Aktion</h3>
                        <div id="dynamic-controls" role="group" aria-labelledby="controls-label" class="flex flex-wrap gap-3">
                            <!-- Buttons injected by JS -->
                        </div>
                    </div>

                    <!-- Visualizations -->
                    <div class="grid grid-cols-1 gap-6">
                        
                        <!-- Table -->
                        <div class="bg-white rounded-lg border-2 border-[var(--color-primary)] overflow-hidden shadow-lg">
                            <div class="overflow-x-auto">
                                <table class="min-w-full data-table text-sm text-left">
                                    <thead class="bg-[var(--color-primary)] text-white uppercase tracking-wider font-semibold">
                                        <tr id="table-header" style="font-family: 'Roboto Slab', serif;">
                                            <!-- Headers injected JS -->
                                        </tr>
                                    </thead>
                                    <tbody id="table-body" class="divide-y divide-[var(--color-soft)]">
                                        <!-- Rows injected JS -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="p-2 text-xs text-[var(--color-primary)] opacity-70 text-right bg-[var(--color-secondary)] bg-opacity-20 italic">12 Datens√§tze in Datenbank</div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" role="dialog" aria-modal="true" aria-label="Kapitelnavigation" class="fixed inset-0 bg-[var(--color-primary)] bg-opacity-95 z-50 hidden flex flex-col justify-center items-center text-white">
        <button id="close-mobile-menu" aria-label="Men√º schlie√üen" class="absolute top-5 right-5 text-white text-2xl hover:text-[var(--color-secondary)]">&times;</button>
        <nav class="space-y-4 text-center">
            <a href="#intro"         onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">1. SELECT &amp; FROM</a>
            <a href="#where"         onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">2. WHERE</a>
            <a href="#orderby"       onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">3. ORDER BY (Einfach)</a>
            <a href="#orderby-multi" onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">4. ORDER BY (Komplex)</a>
            <a href="#and"           onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">5. AND</a>
            <a href="#limit"         onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">6. LIMIT</a>
            <a href="#distinct"      onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">7. DISTINCT</a>
            <a href="#datetime"      onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">8. DATETIME</a>
            <a href="#strings"       onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">9. Zeichenketten</a>
            <a href="#summary"       onclick="toggleMobileMenu()" class="block text-xl p-2 hover:text-[var(--color-secondary)]">Zusammenfassung</a>
        </nav>
    </div>

    <script>
        // --- Data Source ---
        const rawData = [
            { id: 1, titel: "Inception", jahr: 2010, genre: "Action", rating: 8.8, eingetragen_am: "2024-09-01T10:15:00" },
            { id: 2, titel: "The Dark Knight", jahr: 2008, genre: "Action", rating: 9.0, eingetragen_am: "2024-09-01T10:20:00" },
            { id: 3, titel: "Interstellar", jahr: 2014, genre: "Sci-Fi", rating: 8.6, eingetragen_am: "2024-09-02T08:00:00" },
            { id: 4, titel: "Toy Story", jahr: 1995, genre: "Animation", rating: 8.3, eingetragen_am: "2023-03-15T12:30:00" },
            { id: 5, titel: "Pulp Fiction", jahr: 1994, genre: "Crime", rating: 8.9, eingetragen_am: "2022-11-10T09:45:00" },
            { id: 6, titel: "The Matrix", jahr: 1999, genre: "Action", rating: 8.7, eingetragen_am: "2021-06-05T14:05:00" },
            { id: 7, titel: "Forrest Gump", jahr: 1994, genre: "Drama", rating: 8.8, eingetragen_am: "2019-05-20T11:00:00" },
            { id: 8, titel: "Parasite", jahr: 2019, genre: "Thriller", rating: 8.6, eingetragen_am: "2019-10-01T18:15:00" },
            { id: 9, titel: "Avengers: Endgame", jahr: 2019, genre: "Action", rating: 8.4, eingetragen_am: "2020-02-14T16:45:00" },
            { id: 10, titel: "Lion King", jahr: 1994, genre: "Animation", rating: 8.5, eingetragen_am: "2018-12-31T23:50:00" },
            { id: 11, titel: "Joker", jahr: 2019, genre: "Crime", rating: 8.4, eingetragen_am: "2020-01-02T09:10:00" },
            { id: 12, titel: "Tenet", jahr: 2020, genre: "Action", rating: 7.3, eingetragen_am: "2020-09-15T13:25:00" }
        ];

        // --- State Management ---
        let currentData = [...rawData];
        let currentColumns = ['titel', 'jahr', 'genre', 'rating'];
        let currentSection = 'intro';

        // --- Content Definitions ---
        const sections = {
            'intro': {
                title: "1. SELECT & FROM",
                content: `
                    <p class="mb-4">
                        Willkommen! Wir starten mit den absoluten Grundlagen. In SQL bestimmen zwei Befehle das Fundament jeder Abfrage:
                    </p>
                    <div class="bg-white p-4 rounded-lg border-l-4 border-[var(--color-secondary)] shadow-sm mb-6">
                        <h3 class="font-bold mb-2">Die Regel</h3>
                        <p class="text-sm mb-2"><strong><a href="https://mariadb.com/docs/server/reference/sql-statements/data-manipulation/selecting-data/select" target="_blank" class="hover:underline">SELECT</a></strong> bestimmt das <em>WAS</em> (die Spalten).</p>
                        <p class="text-sm"><strong><a href="https://mariadb.com/docs/server/reference/sql-statements/data-manipulation/selecting-data/select" target="_blank" class="hover:underline">FROM</a></strong> bestimmt das <em>WO HER</em> (die Tabelle).</p>
                    </div>
                    <p class="mb-4">
                        Im Simulator rechts siehst du unsere Tabelle <code>filme</code>. 
                        Benutze die Buttons unten, um zu sehen, wie sich das Ergebnis √§ndert.
                    </p>
                `,
                controls: [
                    { label: "SELECT * (Alles)", action: () => setColumns(['titel', 'jahr', 'genre', 'rating']), query: "SELECT * FROM filme;" },
                    { label: "SELECT titel, jahr", action: () => setColumns(['titel', 'jahr']), query: "SELECT titel, jahr FROM filme;" },
                    { label: "SELECT titel, rating", action: () => setColumns(['titel', 'rating']), query: "SELECT titel, rating FROM filme;" }
                ]
            },
            'where': {
                title: "2. WHERE (Der Filter)",
                content: `
                    <p class="mb-4">
                        Jetzt wird es interessant. Meistens wollen wir nicht <em>alle</em> Filme sehen, sondern nur bestimmte. 
                        Daf√ºr nutzen wir <code><a href="https://mariadb.com/kb/en/where/" target="_blank" class="hover:underline">WHERE</a></code>.
                    </p>
                    <h3 class="font-bold mt-6 mb-2">Syntax Highlights</h3>
                    <ul class="list-disc list-inside text-sm space-y-2 mb-6">
                        <li>Text braucht Anf√ºhrungszeichen: <code>genre = 'Action'</code></li>
                        <li>Zahlen stehen nackt: <code>jahr > 2000</code></li>
                        <li>Operatoren: <code>=</code>, <code>!=</code>, <code>></code>, <code><</code></li>
                    </ul>
                    <p class="mb-4">
                        Teste die Filter rechts. Beobachte, wie Zeilen verschwinden, die nicht zur Bedingung passen.
                    </p>
                `,
                controls: [
                    { label: "Alle zeigen (Reset)", action: () => filterData(() => true), query: "SELECT * FROM filme;" },
                    { label: "genre = 'Action'", action: () => filterData(row => row.genre === 'Action'), query: "SELECT * FROM filme WHERE genre = 'Action';" },
                    { label: "jahr > 2010", action: () => filterData(row => row.jahr > 2010), query: "SELECT * FROM filme WHERE jahr > 2010;" },
                    { label: "rating >= 8.8", action: () => filterData(row => row.rating >= 8.8), query: "SELECT * FROM filme WHERE rating >= 8.8;" },
                    { label: "genre != 'Action'", action: () => filterData(row => row.genre !== 'Action'), query: "SELECT * FROM filme WHERE genre != 'Action';" }
                ]
            },
            'orderby': {
                title: "3. ORDER BY (Einfach)",
                content: `
                    <p class="mb-4">
                        Datenbanken speichern Daten oft chaotisch. Mit <code><a href="https://mariadb.com/docs/server/reference/sql-statements/data-manipulation/selecting-data/order-by/" target="_blank" class="hover:underline">ORDER BY</a></code> bringen wir Ordnung rein.
                    </p>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-100 p-3 rounded border border-gray-300">
                            <span class="block font-bold">ASC</span>
                            <span class="text-xs">Aufsteigend (Standard)<br>1 -> 9<br>A -> Z</span>
                        </div>
                        <div class="bg-gray-100 p-3 rounded border border-gray-300">
                            <span class="block font-bold">DESC</span>
                            <span class="text-xs">Absteigend<br>9 -> 1<br>Z -> A</span>
                        </div>
                    </div>
                    <p class="mb-4">
                        Dieser Befehl kommt <strong>immer nach</strong> <code>WHERE</code> (falls vorhanden).
                    </p>
                `,
                controls: [
                    { label: "Standard (Reset)", action: () => resetData(), query: "SELECT * FROM filme;" },
                    { label: "ORDER BY rating DESC", action: () => sortData('rating', 'desc'), query: "SELECT * FROM filme ORDER BY rating DESC;" },
                    { label: "ORDER BY rating ASC", action: () => sortData('rating', 'asc'), query: "SELECT * FROM filme ORDER BY rating ASC;" },
                    { label: "ORDER BY jahr DESC", action: () => sortData('jahr', 'desc'), query: "SELECT * FROM filme ORDER BY jahr DESC;" },
                    { label: "ORDER BY titel ASC", action: () => sortData('titel', 'asc'), query: "SELECT * FROM filme ORDER BY titel ASC;" }
                ]
            },
            'orderby-multi': {
                title: "4. ORDER BY (Mehrere Spalten)",
                content: `
                    <p class="mb-4">
                        Was passiert, wenn zwei Filme das gleiche Rating haben? Die Reihenfolge ist dann oft zuf√§llig.
                        Um das zu verhindern, k√∂nnen wir eine <strong>zweite Sortierregel</strong> hinzuf√ºgen.
                    </p>
                    <div class="bg-white border border-gray-300 p-4 rounded-lg mb-6 shadow-sm">
                        <h4 class="font-bold text-sm mb-2">Die Hierarchie</h4>
                        <ol class="list-decimal list-inside text-sm space-y-1">
                            <li>Sortiere erst nach Spalte 1.</li>
                            <li>Nur bei Gleichstand: Sortiere nach Spalte 2.</li>
                        </ol>
                    </div>
                    <p class="mb-4">
                        Probier es aus: Sortiere nach Genre. Innerhalb der Action-Filme sortieren wir dann nach Jahr.
                    </p>
                `,
                controls: [
                    { label: "Reset", action: () => resetData(), query: "SELECT * FROM filme;" },
                    { 
                        label: "Genre ASC, Jahr DESC", 
                        action: () => sortDataMulti(['genre', 'asc'], ['jahr', 'desc']), 
                        query: "SELECT * FROM filme ORDER BY genre ASC, jahr DESC;" 
                    },
                    { 
                        label: "Rating DESC, Titel ASC", 
                        action: () => sortDataMulti(['rating', 'desc'], ['titel', 'asc']), 
                        query: "SELECT * FROM filme ORDER BY rating DESC, titel ASC;" 
                    }
                ]
            },
            'and': {
                title: "5. AND (Mehrere Bedingungen)",
                content: `
                    <p class="mb-4">
                        Mit <code><a href="https://mariadb.com/kb/en/where/" target="_blank" class="hover:underline">WHERE</a></code> filterst du nach <em>einer</em> Bedingung. Oft brauchst du aber mehrere Kriterien.
                        Genau daf√ºr gibt es <code><a href="https://mariadb.com/kb/en/and/" target="_blank" class="hover:underline">AND</a></code>.
                    </p>
                    <div class="bg-white border border-gray-300 p-4 rounded-lg mb-6 shadow-sm">
                        <h4 class="font-bold text-sm mb-2">Syntax</h4>
                        <p class="text-sm">
                            <code>SELECT * FROM filme WHERE genre = 'Action' AND jahr &gt; 2010;</code>
                        </p>
                    </div>
                    <p class="text-sm italic mb-4">
                        Merke: <code>AND</code> verengt das Ergebnis (beide Bedingungen m√ºssen wahr sein).
                    </p>
                `,
                controls: [
                    { label: "Reset", action: () => filterData(() => true), query: "SELECT * FROM filme;" },
                    { label: "Action UND jahr > 2010", action: () => filterData(row => row.genre === 'Action' && row.jahr > 2010), query: "SELECT * FROM filme WHERE genre = 'Action' AND jahr > 2010;" },
                    { label: "Crime UND rating >= 8.5", action: () => filterData(row => row.genre === 'Crime' && row.rating >= 8.5), query: "SELECT * FROM filme WHERE genre = 'Crime' AND rating >= 8.5;" },
                    { label: "Jahr >= 2019 UND rating >= 8.4", action: () => filterData(row => row.jahr >= 2019 && row.rating >= 8.4), query: "SELECT * FROM filme WHERE jahr >= 2019 AND rating >= 8.4;" }
                ]
            },
            'limit': {
                title: "6. LIMIT",
                content: `
                    <p class="mb-4">
                        Manchmal wollen wir nur einen kleinen Ausschnitt, zum Beispiel f√ºr eine "Top 3"-Liste.
                        Daf√ºr ist <code><a href="https://mariadb.com/kb/en/limit/" target="_blank" class="hover:underline">LIMIT</a></code> da.
                    </p>
                    <p class="mb-4">
                        <strong>Wichtig:</strong> LIMIT steht fast immer ganz am <strong>Ende</strong> des SQL-Befehls.
                        Es schneidet die Tabelle einfach nach X Zeilen ab.
                    </p>
                    <p class="text-sm italic mb-4">
                        Hinweis: Ohne ORDER BY liefert LIMIT zuf√§llige Zeilen. Kombiniere sie f√ºr sinnvolle Ergebnisse!
                    </p>
                `,
                controls: [
                    { label: "LIMIT 3 (Zuf√§llig)", action: () => limitData(3), query: "SELECT * FROM filme LIMIT 3;" },
                    { label: "LIMIT 5", action: () => limitData(5), query: "SELECT * FROM filme LIMIT 5;" },
                    { 
                        label: "Top 3 (Order + Limit)", 
                        action: () => { sortData('rating', 'desc'); limitData(3); }, 
                        query: "SELECT * FROM filme ORDER BY rating DESC LIMIT 3;" 
                    }
                ]
            },
            'distinct': {
                title: "7. DISTINCT",
                content: `
                    <p class="mb-4">
                        Manchmal enth√§lt eine Tabelle mehrere Zeilen mit dem <em>gleichen</em> Wert in einer Spalte.
                        Wenn du diese Werte nur <strong>einmal</strong> sehen willst, nutzt du <code><a href="https://mariadb.com/kb/en/select/#distinct" target="_blank" class="hover:underline">DISTINCT</a></code>.
                    </p>
                    <div class="bg-white border border-gray-300 p-4 rounded-lg mb-6 shadow-sm">
                        <h4 class="font-bold text-sm mb-2">Merke</h4>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li><code>SELECT DISTINCT spalte FROM tabelle;</code> zeigt jeden Wert nur einmal.</li>
                            <li>Mit mehreren Spalten gilt DISTINCT f√ºr die <strong>Kombination</strong> der Spalten.</li>
                        </ul>
                    </div>
                    <p class="text-sm italic mb-4">
                        Tipp: DISTINCT wird direkt nach <code>SELECT</code> geschrieben.
                    </p>
                `,
                controls: [
                    { label: "DISTINCT genre", action: () => distinctData(['genre']), query: "SELECT DISTINCT genre FROM filme;" },
                    { label: "DISTINCT jahr", action: () => distinctData(['jahr']), query: "SELECT DISTINCT jahr FROM filme;" },
                    { label: "DISTINCT genre, jahr", action: () => distinctData(['genre', 'jahr']), query: "SELECT DISTINCT genre, jahr FROM filme;" },
                    { label: "DISTINCT genre (ORDER BY)", action: () => { distinctData(['genre']); sortData('genre', 'asc'); }, query: "SELECT DISTINCT genre FROM filme ORDER BY genre ASC;" }
                ]
            },
            'datetime': {
                title: "8. DATETIME",
                content: `
                    <p class="mb-4">
                        In SQL speichern wir Datum+Uhrzeit h√§ufig als <code><a href="https://mariadb.com/kb/en/datetime/" target="_blank" class="hover:underline">DATETIME</a></code> (z.B. <code>2020-09-15 13:25:00</code>).
                        Damit kannst du z.B. Eintr√§ge nach einem bestimmten Jahr filtern.
                    </p>
                    <div class="bg-white border border-gray-300 p-4 rounded-lg mb-6 shadow-sm">
                        <h4 class="font-bold text-sm mb-2">Typische Filter</h4>
                        <ul class="list-disc list-inside text-sm space-y-1">
                            <li><code>WHERE <a href="https://mariadb.com/kb/en/year/" target="_blank" class="hover:underline">YEAR</a>(eingetragen_am) = 2019</code></li>
                            <li><code>WHERE eingetragen_am &gt;= '2019-01-01' AND eingetragen_am &lt; '2020-01-01'</code></li>
                        </ul>
                    </div>
                    <p class="text-sm italic mb-4">
                        Hinweis: Ein Bereichs-Filter (von/bis) ist oft schneller als <code>YEAR(...)</code>, weil Indizes besser genutzt werden.
                    </p>
                `,
                controls: [
                    { label: "Spalten anzeigen", action: () => setColumns(['titel', 'eingetragen_am']), query: "SELECT titel, eingetragen_am FROM filme;" },
                    { label: "Eintr√§ge aus 2019", action: () => { setColumns(['titel', 'eingetragen_am']); filterData(row => new Date(row.eingetragen_am).getFullYear() === 2019); }, query: "SELECT titel, eingetragen_am FROM filme WHERE YEAR(eingetragen_am) = 2019;" },
                    { label: "Eintr√§ge aus 2020", action: () => { setColumns(['titel', 'eingetragen_am']); filterData(row => new Date(row.eingetragen_am).getFullYear() === 2020); }, query: "SELECT titel, eingetragen_am FROM filme WHERE YEAR(eingetragen_am) = 2020;" },
                    { label: "Zwischen 2019 und 2020", action: () => { setColumns(['titel', 'eingetragen_am']); filterData(row => row.eingetragen_am >= '2019-01-01T00:00:00' && row.eingetragen_am < '2020-01-01T00:00:00'); }, query: "SELECT titel, eingetragen_am FROM filme WHERE eingetragen_am >= '2019-01-01' AND eingetragen_am < '2020-01-01';" },
                    { label: "Neueste zuerst", action: () => { setColumns(['titel', 'eingetragen_am']); sortData('eingetragen_am', 'desc'); }, query: "SELECT titel, eingetragen_am FROM filme ORDER BY eingetragen_am DESC;" }
                ]
            },
            'strings': {
                title: "9. Zeichenketten (Strings)",
                content: `
                    <p class="mb-6 leading-relaxed">
                        Textdaten sind oft unsauber oder m√ºssen formatiert werden. SQL bietet m√§chtige Werkzeuge, um Texte direkt in der Abfrage zu bearbeiten.
                    </p>
                    
                    <div class="space-y-4 mb-8">
                        <!-- Card 1: Formatting -->
                        <div class="bg-white p-4 rounded border border-gray-200 hover:border-[var(--color-secondary)] transition-colors shadow-sm">
                            <h4 class="font-bold text-[var(--color-primary)] mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                                <span class="text-xl">Aa</span> Formatierung
                            </h4>
                            <ul class="text-sm grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">UPPER(str) / LOWER(str)</code>
                                    <span class="text-gray-500 text-xs">Alles gro√ü- oder kleinschreiben.</span>
                                </li>
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">TRIM(str)</code>
                                    <span class="text-gray-500 text-xs">Entfernt Leerzeichen am Anfang/Ende.</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Card 2: Extraction -->
                        <div class="bg-white p-4 rounded border border-gray-200 hover:border-[var(--color-secondary)] transition-colors shadow-sm">
                            <h4 class="font-bold text-[var(--color-primary)] mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                                <span class="text-xl">‚úÇÔ∏è</span> Ausschneiden
                            </h4>
                            <ul class="text-sm grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">LEFT(str, n) / RIGHT(str, n)</code>
                                    <span class="text-gray-500 text-xs">Nimmt die ersten/letzten <i>n</i> Zeichen.</span>
                                </li>
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">SUBSTRING(str, start, len)</code>
                                    <span class="text-gray-500 text-xs">Schneidet teil heraus (Start bei 1!).</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Card 3: Analysis -->
                        <div class="bg-white p-4 rounded border border-gray-200 hover:border-[var(--color-secondary)] transition-colors shadow-sm">
                            <h4 class="font-bold text-[var(--color-primary)] mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                                <span class="text-xl">üîç</span> Suchen & Finden
                            </h4>
                            <ul class="text-sm grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">INSTR(str, 'such')</code>
                                    <span class="text-gray-500 text-xs">Position des Suchworts (0 w. n. gef.).</span>
                                </li>
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">LIKE '%Muster%'</code>
                                    <span class="text-gray-500 text-xs">Filtert nach Textmustern.</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Card 4: Modification -->
                        <div class="bg-white p-4 rounded border border-gray-200 hover:border-[var(--color-secondary)] transition-colors shadow-sm">
                            <h4 class="font-bold text-[var(--color-primary)] mb-4 flex items-center gap-2 border-b border-gray-100 pb-2">
                                <span class="text-xl">‚úèÔ∏è</span> Bearbeiten
                            </h4>
                            <ul class="text-sm grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">REPLACE(str, 'alt', 'neu')</code>
                                    <span class="text-gray-500 text-xs">Tauscht Textteile aus.</span>
                                </li>
                                <li class="flex flex-col">
                                    <code class="font-bold text-[var(--color-soft)]">CHAR_LENGTH(str)</code>
                                    <span class="text-gray-500 text-xs">Z√§hlt die Zeichenanzahl.</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-[var(--color-secondary)] text-sm mb-6">
                        <strong>üí° Tipp:</strong> String-Funktionen sind perfekt, um "schmutzige" Daten zu reinigen, bevor man sie dem Benutzer anzeigt.
                    </div>
                `,
                controls: [
                    { 
                        label: "üîÑ Reset", 
                        action: () => { 
                            currentColumns = ['titel', 'jahr', 'genre', 'rating'];
                            currentData = [...rawData];
                            renderTable(); 
                        }, 
                        query: "SELECT * FROM filme;" 
                    },
                    { 
                        label: "üî† Gro√übuchstaben (UPPER)", 
                        action: () => { 
                            currentColumns = ['UPPER(titel)', 'genre'];
                            currentData = rawData.map(r => ({ ...r, 'UPPER(titel)': r.titel.toUpperCase() })); 
                            renderTable(); 
                        }, 
                        query: "SELECT UPPER(titel), genre FROM filme;" 
                    },
                    { 
                        label: "ÔøΩ Kleinbuchstaben (LOWER)", 
                        action: () => { 
                            currentColumns = ['LOWER(titel)', 'genre'];
                            currentData = rawData.map(r => ({ ...r, 'LOWER(titel)': r.titel.toLowerCase() })); 
                            renderTable(); 
                        }, 
                        query: "SELECT LOWER(titel), genre FROM filme;" 
                    },
                    { 
                        label: "üßº TRIM (Leerzeichen)", 
                        action: () => { 
                            currentColumns = ['"Schmutzig"', 'TRIM'];
                            currentData = rawData.slice(0, 5).map(r => {
                                const dirty = `  ${r.titel}  `;
                                return { '"Schmutzig"': `"${dirty}"`, 'TRIM': `"${dirty.trim()}"` };
                            });
                            renderTable(); 
                        }, 
                        query: "SELECT titel_dirty, TRIM(titel_dirty) FROM filme LIMIT 5;" 
                    },
                    { 
                        label: "üìè L√§nge (CHAR_LENGTH)", 
                        action: () => { 
                            currentColumns = ['titel', 'L√§nge'];
                            currentData = rawData.map(r => ({ ...r, 'L√§nge': r.titel.length })); 
                            renderTable(); 
                        }, 
                        query: "SELECT titel, CHAR_LENGTH(titel) as L√§nge FROM filme;" 
                    },
                    { 
                        label: "‚úÇÔ∏è Links (LEFT)", 
                        action: () => { 
                            currentColumns = ['Orig', 'Left3'];
                            currentData = rawData.map(r => ({ 'Orig': r.titel, 'Left3': r.titel.substring(0, 3) })); 
                            renderTable(); 
                        }, 
                        query: "SELECT titel, LEFT(titel, 3) FROM filme;" 
                    },
                    { 
                        label: "‚úÇÔ∏è Rechts (RIGHT)", 
                        action: () => { 
                            currentColumns = ['Orig', 'Right3'];
                            currentData = rawData.map(r => ({ 'Orig': r.titel, 'Right3': r.titel.slice(-3) })); 
                            renderTable(); 
                        }, 
                        query: "SELECT titel, RIGHT(titel, 3) FROM filme;" 
                    },
                    { 
                        label: "üß© Teil (SUBSTRING)", 
                        action: () => { 
                            currentColumns = ['titel', 'Sub(2,4)'];
                            currentData = rawData.map(r => ({ 'titel': r.titel, 'Sub(2,4)': r.titel.substring(1, 5) })); 
                            renderTable(); 
                        }, 
                        query: "SELECT titel, SUBSTRING(titel, 2, 4) FROM filme;" 
                    },
                    { 
                        label: "üîç Position (INSTR)", 
                        action: () => { 
                            currentColumns = ['titel', 'Pos "The"'];
                            currentData = rawData.map(r => ({ 'titel': r.titel, 'Pos "The"': r.titel.indexOf('The') + 1 })); 
                            renderTable(); 
                        }, 
                        query: "SELECT titel, INSTR(titel, 'The') FROM filme;" 
                    },
                    { 
                        label: "üîé Muster (LIKE)", 
                        action: () => { 
                            filterData(r => r.titel.includes('King'));
                        }, 
                        query: "SELECT * FROM filme WHERE titel LIKE '%King%';" 
                    },
                    { 
                        label: "‚úèÔ∏è Ersetzen (REPLACE)", 
                        action: () => { 
                            currentColumns = ['titel', 'alt', 'neu'];
                            currentData = rawData.filter(r => r.genre === 'Action').map(r => ({ 
                                'titel': r.titel, 
                                'alt': r.genre, 
                                'neu': r.genre.replaceAll('Action', 'Drama') 
                            })); 
                            renderTable(); 
                        }, 
                        query: "SELECT titel, genre AS alt, REPLACE(genre, 'Action', 'Drama') AS neu FROM filme WHERE genre='Action';" 
                    }
                ]
            },
            'summary': {
                title: "Zusammenfassung & Quiz",
                content: `
                    <h3 class="text-xl font-bold mb-4">Die Goldene Reihenfolge</h3>
                    <p class="mb-6">
                        SQL verzeiht keine Fehler in der Reihenfolge. Du musst dich strikt an diesen Aufbau halten.
                    </p>

                    <div class="bg-white p-4 rounded-lg border-l-4 border-[var(--color-secondary)] shadow-sm mb-6">
                        <h4 class="font-bold mb-1">Hinweis zu AND/OR</h4>
                        <p class="text-sm">
                            <code>AND</code> (und <code>OR</code>) geh√∂rt in die <code>WHERE</code>-Bedingung.
                            Es ist kein eigener "Block" wie <code>ORDER BY</code> oder <code>LIMIT</code>.
                        </p>
                    </div>
                    
                    <div id="order-game-container" class="bg-white p-6 rounded-lg border-2 border-[var(--color-primary)] shadow-md">
                        <h4 class="font-bold text-lg mb-3">Quiz: Bringe die Befehle in die richtige Reihenfolge!</h4>
                        <p class="text-sm mb-4">Klicke die Buttons in der korrekten logischen Abfolge an.</p>
                        
                        <div id="game-buttons" class="flex flex-wrap gap-2 mb-4">
                            <button onclick="gameClick('WHERE')" class="game-btn px-4 py-2 border-2 border-[var(--color-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--color-secondary)] transition font-bold shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-none translate-y-0 active:translate-y-[2px]">WHERE</button>
                            <button onclick="gameClick('LIMIT')" class="game-btn px-4 py-2 border-2 border-[var(--color-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--color-secondary)] transition font-bold shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-none translate-y-0 active:translate-y-[2px]">LIMIT</button>
                            <button onclick="gameClick('SELECT')" class="game-btn px-4 py-2 border-2 border-[var(--color-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--color-secondary)] transition font-bold shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-none translate-y-0 active:translate-y-[2px]">SELECT</button>
                            <button onclick="gameClick('DISTINCT')" class="game-btn px-4 py-2 border-2 border-[var(--color-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--color-secondary)] transition font-bold shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-none translate-y-0 active:translate-y-[2px]">DISTINCT</button>
                            <button onclick="gameClick('ORDER BY')" class="game-btn px-4 py-2 border-2 border-[var(--color-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--color-secondary)] transition font-bold shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-none translate-y-0 active:translate-y-[2px]">ORDER BY</button>
                            <button onclick="gameClick('FROM')" class="game-btn px-4 py-2 border-2 border-[var(--color-primary)] text-[var(--color-primary)] rounded hover:bg-[var(--color-secondary)] transition font-bold shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-none translate-y-0 active:translate-y-[2px]">FROM</button>
                        </div>

                        <div id="game-result" class="min-h-[40px] p-2 bg-gray-50 rounded border border-gray-200 flex items-center gap-2 font-mono text-sm">
                            <span class="text-gray-400">Dein Query:</span>
                            <span id="game-output" class="font-bold"></span>
                        </div>
                        <div id="game-message" role="status" aria-live="polite" class="mt-2 text-sm font-bold min-h-[20px]"></div>
                        <button onclick="resetGame()" class="mt-4 text-xs text-gray-500 underline hover:text-[var(--color-primary)]">Reset Quiz</button>
                    </div>
                `,
                controls: [
                    { label: "Alle Daten zur√ºcksetzen", action: () => resetData(), query: "SELECT * FROM filme;" }
                ]
            }
        };

        // --- Core Functions ---

        function init() {
            const hash = location.hash.slice(1);
            navigateTo(hash && sections[hash] ? hash : 'intro');

            window.addEventListener('hashchange', () => {
                const id = location.hash.slice(1);
                if (id && sections[id]) navigateTo(id);
            });

            document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);
            document.getElementById('close-mobile-menu').addEventListener('click', toggleMobileMenu);
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('mobile-menu-btn');
            const isHidden = menu.classList.toggle('hidden');
            btn.setAttribute('aria-expanded', !isHidden);
        }

        function switchMobileTab(tab) {
            const contentArea = document.getElementById('content-area');
            const simArea = document.getElementById('simulation-area');
            const btnContent = document.getElementById('tab-content');
            const btnSim = document.getElementById('tab-simulation');

            if (tab === 'content') {
                contentArea.classList.remove('hidden');
                contentArea.removeAttribute('aria-hidden');
                simArea.classList.add('hidden');
                simArea.classList.remove('flex');
                simArea.setAttribute('aria-hidden', 'true');

                btnContent.setAttribute('aria-pressed', 'true');
                btnContent.classList.remove('text-gray-400', 'border-transparent');
                btnContent.classList.add('text-[var(--color-primary)]', 'bg-gray-50', 'border-t-4', 'border-[var(--color-secondary)]');
                btnSim.setAttribute('aria-pressed', 'false');
                btnSim.classList.add('text-gray-400');
                btnSim.classList.remove('text-[var(--color-primary)]', 'bg-gray-50', 'border-t-4', 'border-[var(--color-secondary)]');
            } else {
                contentArea.classList.add('hidden');
                contentArea.setAttribute('aria-hidden', 'true');
                simArea.classList.remove('hidden');
                simArea.classList.add('flex');
                simArea.removeAttribute('aria-hidden');

                btnSim.setAttribute('aria-pressed', 'true');
                btnSim.classList.remove('text-gray-400', 'border-transparent');
                btnSim.classList.add('text-[var(--color-primary)]', 'bg-gray-50', 'border-t-4', 'border-[var(--color-secondary)]');
                btnContent.setAttribute('aria-pressed', 'false');
                btnContent.classList.add('text-gray-400');
                btnContent.classList.remove('text-[var(--color-primary)]', 'bg-gray-50', 'border-t-4', 'border-[var(--color-secondary)]');
            }
        }

        function navigateTo(sectionId) {
            currentSection = sectionId;

            if (location.hash !== '#' + sectionId) {
                history.replaceState(null, '', '#' + sectionId);
            }
            
            // Update Nav Styles
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
                el.removeAttribute('aria-current');
            });
            const activeNav = document.getElementById(`nav-${sectionId}`);
            if (activeNav) {
                activeNav.classList.add('active');
                activeNav.setAttribute('aria-current', 'page');
            }

            // Update Content Area
            const contentArea = document.getElementById('content-area');
            const data = sections[sectionId];
            
            // Render content first
            contentArea.innerHTML = `
                <h2 style="color: var(--color-primary)" class="text-3xl font-bold mb-6 border-b-4 border-[var(--color-secondary)] pb-2 inline-block">${data.title}</h2>
                <div class="prose max-w-none text-base leading-relaxed">
                    ${data.content}
                </div>
            `;
            
            contentArea.querySelectorAll('code').forEach(block => {
                // Skip blocks with links to preserve anchor tags
                if (block.querySelector('a')) {
                    block.classList.add('language-sql');
                    return;
                }

                block.classList.add('language-sql');
                try {
                    Prism.highlightElement(block);
                } catch (e) { console.warn("Prism highlight failed", e); }
            });

            const controlsArea = document.getElementById('dynamic-controls');
            controlsArea.innerHTML = '';
            data.controls.forEach(ctrl => {
                const btn = document.createElement('button');
                btn.className = 'control-btn';
                btn.innerText = ctrl.label;
                btn.onclick = () => {
                    document.querySelectorAll('.control-btn').forEach(b => b.classList.remove('is-active'));
                    btn.classList.add('is-active');
                    document.getElementById('query-display').innerHTML = Prism.highlight(ctrl.query, Prism.languages.sql, 'sql');
                    ctrl.action();
                };
                controlsArea.appendChild(btn);
            });

            resetData();
            document.getElementById('query-display').innerHTML = "Bereit...";

            // Some sections benefit from an immediate, visible default state.
            if (sectionId === 'datetime') {
                const firstCtrl = sections[sectionId]?.controls?.[0];
                if (firstCtrl) {
                    const highlightedQuery = Prism.highlight(firstCtrl.query, Prism.languages.sql, 'sql');
                    document.getElementById('query-display').innerHTML = highlightedQuery;
                    firstCtrl.action();
                }
            }
            
            if (sectionId === 'summary') {
                resetGame();
            }
        }

        function renderTable() {
            const thead = document.getElementById('table-header');
            const tbody = document.getElementById('table-body');
            thead.innerHTML = '';
            tbody.innerHTML = '';

            currentColumns.forEach(col => {
                const th = document.createElement('th');
                th.className = "px-6 py-4 font-bold text-xs tracking-wider border-b-2 border-[var(--color-primary)] text-left";
                th.innerText = col.toUpperCase();
                thead.appendChild(th);
            });

            currentData.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-[var(--color-secondary)] hover:bg-opacity-20 transition-colors border-b border-gray-200 last:border-0";

                currentColumns.forEach(col => {
                    const td = document.createElement('td');
                    td.className = "px-6 py-3 text-[var(--color-primary)] font-medium border-l border-transparent text-sm";
                    
                    if (typeof row[col] === 'number') {
                         td.classList.add('font-mono', 'text-[var(--color-primary)]', 'font-bold');
                    }
                    
                    td.innerText = row[col];
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        // --- SQL Operations Logic ---

        function resetData() {
            currentData = [...rawData];
            currentColumns = ['titel', 'jahr', 'genre', 'rating'];
            renderTable();
            const highlightedQuery = Prism.highlight("SELECT * FROM filme;", Prism.languages.sql, 'sql');
            document.getElementById('query-display').innerHTML = highlightedQuery;
        }

        function setColumns(cols) {
            currentColumns = cols;
            renderTable();
        }

        function filterData(predicate) {
            currentData = rawData.filter(predicate);
            renderTable();
        }

        function sortData(key, direction) {
            const sorted = [...currentData].sort((a, b) => {
                if (a[key] < b[key]) return direction === 'asc' ? -1 : 1;
                if (a[key] > b[key]) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            currentData = sorted;
            renderTable();
        }

        function sortDataMulti(rule1, rule2) {
            const sorted = [...currentData].sort((a, b) => {
                if (a[rule1[0]] < b[rule1[0]]) return rule1[1] === 'asc' ? -1 : 1;
                if (a[rule1[0]] > b[rule1[0]]) return rule1[1] === 'asc' ? 1 : -1;
                if (a[rule2[0]] < b[rule2[0]]) return rule2[1] === 'asc' ? -1 : 1;
                if (a[rule2[0]] > b[rule2[0]]) return rule2[1] === 'asc' ? 1 : -1;
                
                return 0;
            });
            currentData = sorted;
            renderTable();
        }

        function limitData(n) {
            currentData = currentData.slice(0, n);
            renderTable();
        }

        function distinctData(cols) {
            const seen = new Set();
            const distinctRows = [];

            for (const row of currentData) {
                const key = cols.map(c => String(row[c])).join('\u0000');
                if (seen.has(key)) continue;
                seen.add(key);

                const out = {};
                cols.forEach(c => { out[c] = row[c]; });
                distinctRows.push(out);
            }

            currentColumns = cols;
            currentData = distinctRows;
            renderTable();
        }

        // --- Game Logic ---
        let gameSequence = [];
        const correctSequence = ['SELECT', 'DISTINCT', 'FROM', 'WHERE', 'ORDER BY', 'LIMIT'];

        function gameClick(keyword) {
            if (gameSequence.includes(keyword)) return;
            
            gameSequence.push(keyword);
            
            const output = document.getElementById('game-output');
            output.innerText = gameSequence.join('  >>  ');

            checkGame();
        }

        function checkGame() {
            const msg = document.getElementById('game-message');
            for (let i = 0; i < gameSequence.length; i++) {
                if(gameSequence[i] !== correctSequence[i]) {
                    msg.innerText = "‚ùå Falsche Reihenfolge! Reset...";
                    msg.className = "mt-2 text-sm font-bold text-red-600";
                    setTimeout(resetGame, 1000);
                    return;
                }
            }

            if(gameSequence.length === correctSequence.length) {
                msg.innerText = "‚úÖ Perfekt! Das ist die korrekte SQL Syntax.";
                msg.className = "mt-2 text-sm font-bold text-[var(--color-accent)]";
            } else {
                msg.innerText = "Gut so... weiter...";
                msg.className = "mt-2 text-sm font-bold text-[var(--color-primary)]";
            }
        }

        function resetGame() {
            gameSequence = [];
            document.getElementById('game-output').innerText = "";
            document.getElementById('game-message').innerText = "";
        }

        init();

    </script>
</body>
</html>
